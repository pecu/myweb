<!DOCTYPE html>
<html>
<head>
    <title>OpenAI 聊天機器人</title>
</head>
<body>
    <h1>OpenAI 聊天機器人</h1>
    <label for="apiKey">API Key:</label>
    <input type="text" id="apiKey"><br>
    <label for="topic">主題:</label>
    <input type="text" id="topic"><br>
    <button onclick="startChat()">開始</button>
    <button onclick="stopChat()">停止</button><br><br>
    <div id="chat"></div>

    <script>
        let apiKey = "";
        let topic = "";
        let chatInterval;

        function startChat() {
            apiKey = document.getElementById("apiKey").value;
            topic = document.getElementById("topic").value;
            chatInterval = setInterval(chatWithOpenAI, 2000); // 每2秒聊一次
            document.getElementById("chat").innerHTML = "聊天開始：<br>";
        }

        function stopChat() {
            clearInterval(chatInterval);
            document.getElementById("chat").innerHTML += "聊天已停止。<br>";
        }

        async function chatWithOpenAI() {
            if (!apiKey || !topic) {
                alert("請輸入API Key和主題！");
                return;
            }

            const chatDiv = document.getElementById("chat");
            chatDiv.innerHTML += "等待 OpenAI 回應...<br>";

            try {
                const response = await fetch("https://api.openai.com/v1/engines/davinci-codex/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        prompt: `Mom: ${topic}\nSon:`,
                        max_tokens: 50
                    })
                });

                const data = await response.json();
                const message = data.choices[0].text.trim();

                chatDiv.innerHTML += `Mom: ${message}<br>`;
                chatDiv.scrollTop = chatDiv.scrollHeight;
            } catch (error) {
                console.error("發生錯誤：", error);
                chatDiv.innerHTML += "發生錯誤，請檢查API Key和主題。<br>";
            }
        }
    </script>
</body>
</html>
